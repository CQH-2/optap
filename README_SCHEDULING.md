# OptaPlanner è½¦é—´æ’ç¨‹ç³»ç»Ÿ

ä¸€ä¸ªåŸºäºOptaPlanner 9.xçš„å¤šå“ç§å°æ‰¹é‡ç¦»æ•£è£…é…è½¦é—´æ™ºèƒ½ç”Ÿäº§æ’ç¨‹ç³»ç»Ÿã€‚

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬ç³»ç»Ÿä½¿ç”¨OptaPlannerçš„çº¦æŸæµï¼ˆConstraintStreamsï¼‰APIï¼Œåœ¨æ»¡è¶³å¤æ‚å®é™…çº¦æŸçš„å‰æä¸‹ï¼Œä¸ºè®¢å•å·¥åºåˆ†é…æœ€ä¼˜çš„ç”Ÿäº§çº¿å’Œå¼€å§‹æ—¶é—´ã€‚

### æ ¸å¿ƒåŠŸèƒ½

- âœ… **ç”Ÿäº§çº¿èµ„æºç®¡ç†**ï¼šæ”¯æŒå¤šæ¡ç”Ÿäº§çº¿ï¼Œæ¯æ¡çº¿æœ‰ä¸åŒçš„å·¥è‰ºèƒ½åŠ›
- âœ… **å·¥åºæ’ç¨‹**ï¼šä¸ºè®¢å•å·¥åºåˆ†é…ç”Ÿäº§çº¿å’Œå¼€å§‹æ—¶é—´
- âœ… **çº¦æŸæ»¡è¶³**ï¼šæ»¡è¶³ç”Ÿäº§çº¿äº’æ–¥ã€å·¥åºé¡ºåºã€BOMé½å¥—ã€äº§èƒ½ä¸Šé™ç­‰ç¡¬çº¦æŸ
- âœ… **ä¼˜åŒ–ç›®æ ‡**ï¼šæœ€å°åŒ–å»¶è¯¯ã€æ¢çº¿æ—¶é—´ã€è´Ÿè½½å‡è¡¡

## ğŸ—ï¸ ä¸šåŠ¡æ¨¡å‹

### æ ¸å¿ƒå®ä½“

| å®ä½“ | æè¿° | å…³é”®å±æ€§ |
|------|------|---------|
| **Order** | è®¢å• | id, dueDate, priority, operations |
| **Process** | å·¥è‰ºç±»å‹ | id, name (å¦‚Assembly, Testing) |
| **Operation** | å·¥åºï¼ˆè§„åˆ’å®ä½“ï¼‰ | id, order, process, quantity, standardHours, **assignedLine**, **startTime** |
| **ProductionLine** | ç”Ÿäº§çº¿ | code |
| **Material** | ç‰©æ–™ | id, name |
| **BOMItem** | ç‰©æ–™æ¸…å•é¡¹ | operation, material, quantity |
| **Inventory** | åº“å­˜ | material, availableQty, snapshotTime |
| **LineProcessCapacity** | äº§çº¿å·¥è‰ºäº§èƒ½ | line, process, maxUnitsPerHour |

### è§„åˆ’å˜é‡

`Operation` ç±»æ˜¯è§„åˆ’å®ä½“ï¼Œæœ‰ä¸¤ä¸ªè§„åˆ’å˜é‡ï¼š
- `assignedLine`: åˆ†é…çš„ç”Ÿäº§çº¿ï¼ˆProductionLineç±»å‹ï¼‰
- `startTime`: å¼€å§‹æ—¶é—´æˆ³ï¼ˆLongç±»å‹ï¼‰

## ğŸ¯ çº¦æŸè§„åˆ™

### ç¡¬çº¦æŸï¼ˆå¿…é¡»æ»¡è¶³ï¼‰

1. **ç”Ÿäº§çº¿äº’æ–¥**ï¼šåŒä¸€ç”Ÿäº§çº¿ä¸Šçš„å·¥åºæ—¶é—´ä¸èƒ½é‡å 
2. **å·¥åºé¡ºåº**ï¼šåŒä¸€è®¢å•å†…ï¼Œåç»­å·¥åºå¿…é¡»åœ¨å‰åºå·¥åºå®Œæˆåæ‰èƒ½å¼€å§‹
3. **BOMé½å¥—æ€§**ï¼šå·¥åºå¼€å§‹æ—¶ï¼Œæ‰€éœ€æ‰€æœ‰ç‰©æ–™çš„å¯ç”¨åº“å­˜å¿…é¡»å……è¶³
4. **äº§èƒ½ä¸Šé™**ï¼šå·¥åºçš„æ¯å°æ—¶è®¡åˆ’äº§é‡ä¸èƒ½è¶…è¿‡ç”Ÿäº§çº¿å¯¹è¯¥å·¥è‰ºçš„maxUnitsPerHour
5. **å·¥è‰ºåŒ¹é…**ï¼šå·¥åºåªèƒ½åˆ†é…ç»™å…·å¤‡å…¶å·¥è‰ºç”Ÿäº§èƒ½åŠ›çš„ç”Ÿäº§çº¿

### è½¯çº¦æŸï¼ˆä¼˜åŒ–ç›®æ ‡ï¼‰

1. **æœ€å°åŒ–æ€»å»¶è¯¯**ï¼šæƒ©ç½šè®¢å•å®Œæˆæ—¶é—´æ™šäºäº¤è´§æœŸï¼ˆå»¶è¯¯æ—¶é—´ Ã— ä¼˜å…ˆçº§ï¼‰
2. **æœ€å°åŒ–æ¢çº¿æ—¶é—´**ï¼šåŒä¸€ç”Ÿäº§çº¿ä¸Šï¼ŒåŠ å·¥ä¸åŒå·¥è‰ºçš„å·¥åºåˆ‡æ¢æ—¶äº§ç”Ÿæƒ©ç½š
3. **å‡è¡¡è´Ÿè½½**ï¼šå°½é‡é¿å…æŸäº›ç”Ÿäº§çº¿è¿‡è½½è€ŒæŸäº›é—²ç½®

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶

- Java 17+
- Maven 3.6+

### æ„å»ºé¡¹ç›®

```bash
cd com.iimsoft.scheduler
mvn clean compile
```

### è¿è¡Œç¤ºä¾‹

```bash
mvn exec:java
```

### é¢„æœŸè¾“å‡º

```
=== OptaPlanner è½¦é—´æ’ç¨‹ç³»ç»Ÿ ===

ã€åˆå§‹é…ç½®ã€‘

ç”Ÿäº§çº¿é…ç½®ï¼š
  - Line_A
  - Line_B

å·¥è‰ºç±»å‹ï¼š
  - Assembly: ç»„è£…å·¥è‰º
  - Testing: æµ‹è¯•å·¥è‰º
  - Packing: åŒ…è£…å·¥è‰º

ç”Ÿäº§çº¿å·¥è‰ºäº§èƒ½ï¼š
  - Line_A æ‰§è¡Œ Assembly: 50ä»¶/å°æ—¶
  - Line_A æ‰§è¡Œ Testing: 30ä»¶/å°æ—¶
  - Line_B æ‰§è¡Œ Testing: 40ä»¶/å°æ—¶
  - Line_B æ‰§è¡Œ Packing: 60ä»¶/å°æ—¶

è®¢å•ä¿¡æ¯ï¼š
  è®¢å• ORD001 (ä¼˜å…ˆçº§=8, äº¤è´§æœŸ=2026-01-12)
    - å·¥åº OP001: Assembly, æ•°é‡=45, å·¥æ—¶=1.0å°æ—¶
    - å·¥åº OP002: Testing, æ•°é‡=20, å·¥æ—¶=0.5å°æ—¶

=== å¼€å§‹æ±‚è§£ï¼ˆ30ç§’ï¼‰===

=== æ±‚è§£å®Œæˆ ===

ã€æ±‚è§£ç»“æœã€‘
æœ€ç»ˆåˆ†æ•°: 0hard/XXXsoft

å·¥åºæ’ç¨‹ç»“æœï¼š
  å·¥åº OP001::Assembly
    åˆ†é…ç”Ÿäº§çº¿: Line_A
    å¼€å§‹æ—¶é—´: 2026-01-07 09:00
    ç»“æŸæ—¶é—´: 2026-01-07 10:00
    åŠ å·¥æ•°é‡: 45ä»¶, å·¥æ—¶: 1.0å°æ—¶
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
com.iimsoft.scheduler/
â”œâ”€â”€ src/main/java/com/iimsoft/scheduler/
â”‚   â”œâ”€â”€ domain/                          # é¢†åŸŸæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Order.java                   # è®¢å•
â”‚   â”‚   â”œâ”€â”€ Process.java                 # å·¥è‰ºç±»å‹
â”‚   â”‚   â”œâ”€â”€ Operation.java               # å·¥åºï¼ˆè§„åˆ’å®ä½“ï¼‰
â”‚   â”‚   â”œâ”€â”€ ProductionLine.java          # ç”Ÿäº§çº¿
â”‚   â”‚   â”œâ”€â”€ Material.java                # ç‰©æ–™
â”‚   â”‚   â”œâ”€â”€ BOMItem.java                 # ç‰©æ–™æ¸…å•é¡¹
â”‚   â”‚   â”œâ”€â”€ Inventory.java               # åº“å­˜
â”‚   â”‚   â”œâ”€â”€ LineProcessCapacity.java     # äº§çº¿å·¥è‰ºäº§èƒ½
â”‚   â”‚   â””â”€â”€ SchedulingSolution.java      # è§„åˆ’è§£å†³æ–¹æ¡ˆ
â”‚   â”œâ”€â”€ solver/                          # çº¦æŸæä¾›ç±»
â”‚   â”‚   â””â”€â”€ SchedulingConstraintProvider.java
â”‚   â””â”€â”€ SchedulingApp.java               # ä¸»åº”ç”¨ç¨‹åº
â”œâ”€â”€ pom.xml                              # Mavené…ç½®
â””â”€â”€ DESIGN.md                            # è¯¦ç»†è®¾è®¡æ–‡æ¡£
```

## ğŸ”§ æŠ€æœ¯æ ˆ

- **Java**: 17
- **OptaPlanner**: 9.44.0.Final
- **æ„å»ºå·¥å…·**: Maven
- **çº¦æŸå®ç°**: ConstraintStreams API

## ğŸ“– æµ‹è¯•æ•°æ®è¯´æ˜

ç³»ç»Ÿå†…ç½®äº†ä¸€ç»„æµ‹è¯•æ•°æ®ï¼š

### ç”Ÿäº§çº¿é…ç½®
- **Line_A**: 
  - Assemblyï¼ˆç»„è£…ï¼‰: 50ä»¶/å°æ—¶
  - Testingï¼ˆæµ‹è¯•ï¼‰: 30ä»¶/å°æ—¶
- **Line_B**: 
  - Testingï¼ˆæµ‹è¯•ï¼‰: 40ä»¶/å°æ—¶
  - Packingï¼ˆåŒ…è£…ï¼‰: 60ä»¶/å°æ—¶

### è®¢å•ç¤ºä¾‹
- **è®¢å•ORD001**:
  - ä¼˜å…ˆçº§: 8
  - äº¤è´§æœŸ: å½“å‰æ—¥æœŸ + 5å¤©
  - åŒ…å«2ä¸ªå·¥åºï¼š
    - OP001: Assemblyå·¥è‰ºï¼Œ45ä»¶ï¼Œå·¥æ—¶1.0å°æ—¶
    - OP002: Testingå·¥è‰ºï¼Œ20ä»¶ï¼Œå·¥æ—¶0.5å°æ—¶ï¼ˆå¿…é¡»åœ¨OP001å®Œæˆåï¼‰

### BOMä¸åº“å­˜
- OP001éœ€è¦åŸææ–™M001 Ã— 10
- OP002éœ€è¦åŸææ–™M002 Ã— 5
- åˆå§‹åº“å­˜å……è¶³ï¼ˆM001: 100ä»¶ï¼ŒM002: 50ä»¶ï¼‰

## ğŸ’¡ ä½¿ç”¨æŒ‡å—

### è‡ªå®šä¹‰æµ‹è¯•æ•°æ®

ä¿®æ”¹ `SchedulingApp.java` ä¸­çš„ `createTestData()` æ–¹æ³•ï¼š

```java
private static SchedulingSolution createTestData() {
    // 1. åˆ›å»ºç”Ÿäº§çº¿
    ProductionLine lineA = new ProductionLine("Line_A");
    ProductionLine lineB = new ProductionLine("Line_B");
    
    // 2. åˆ›å»ºå·¥è‰º
    Process assembly = new Process("Assembly", "ç»„è£…å·¥è‰º");
    
    // 3. åˆ›å»ºè®¢å•å’Œå·¥åº
    Order order1 = new Order("ORD001", dueDate, 8);
    Operation op1 = new Operation("OP001", order1, assembly, 45, 1.0, 0);
    
    // ... æ›´å¤šé…ç½®
}
```

### è°ƒæ•´æ±‚è§£æ—¶é—´

ä¿®æ”¹ `SchedulingApp.java` ä¸­çš„æ±‚è§£å™¨é…ç½®ï¼š

```java
SolverFactory<SchedulingSolution> solverFactory = SolverFactory.create(
    new SolverConfig()
        // ... å…¶ä»–é…ç½®
        .withTerminationSpentLimit(Duration.ofSeconds(60))  // ä¿®æ”¹ä¸º60ç§’
);
```

### è°ƒæ•´çº¦æŸæƒé‡

ä¿®æ”¹ `SchedulingConstraintProvider.java` ä¸­çš„çº¦æŸæƒ©ç½šå€¼ï¼š

```java
// ä¾‹å¦‚ï¼šå¢åŠ æ¢çº¿æƒ©ç½š
.penalize(HardSoftScore.ONE_SOFT, (op1, op2) -> 200)  // ä»100æ”¹ä¸º200
```

## ğŸ“Š æ€§èƒ½è°ƒä¼˜

1. **æ±‚è§£æ—¶é—´**ï¼šæ ¹æ®é—®é¢˜è§„æ¨¡è°ƒæ•´terminationæ—¶é—´ï¼ˆ30ç§’é€‚åˆå°è§„æ¨¡é—®é¢˜ï¼‰
2. **æ—¶é—´ç²¾åº¦**ï¼šå½“å‰ä½¿ç”¨1å°æ—¶æ­¥é•¿ï¼Œå¯æ ¹æ®éœ€æ±‚è°ƒæ•´
3. **çº¦æŸæƒé‡**ï¼šå¹³è¡¡ç¡¬çº¦æŸå’Œè½¯çº¦æŸçš„é‡è¦æ€§
4. **å¤§è§„æ¨¡é—®é¢˜**ï¼šè€ƒè™‘ä½¿ç”¨å¢é‡è®¡åˆ†å™¨æ›¿ä»£ConstraintStreams

## ğŸ” å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆæ²¡æœ‰æ‰¾åˆ°å¯è¡Œè§£ï¼Ÿ
A: å¯èƒ½åŸå› ï¼š
1. çº¦æŸè¿‡äºä¸¥æ ¼ï¼ˆå¦‚äº§èƒ½ä¸è¶³ã€åº“å­˜ä¸å¤Ÿï¼‰
2. æ±‚è§£æ—¶é—´ä¸å¤Ÿï¼ˆå¢åŠ terminationæ—¶é—´ï¼‰
3. æ—¶é—´çª—å£è®¾ç½®ä¸åˆç†ï¼ˆæ£€æŸ¥planningWindowStart/Endï¼‰

### Q: å¦‚ä½•å¢åŠ æ›´å¤šå·¥åºï¼Ÿ
A: åœ¨ `createTestData()` æ–¹æ³•ä¸­åˆ›å»ºæ›´å¤š Operation å¯¹è±¡ï¼Œå¹¶è®¾ç½®æ­£ç¡®çš„ `sequenceInOrder`

### Q: å¦‚ä½•æ”¯æŒæ›´å¤šçº¦æŸï¼Ÿ
A: åœ¨ `SchedulingConstraintProvider.java` ä¸­æ·»åŠ æ–°çš„çº¦æŸæ–¹æ³•ï¼Œå¹¶åœ¨ `defineConstraints()` ä¸­è¿”å›

## ğŸš§ æ‰©å±•æ–¹å‘

### çŸ­æœŸ
- [ ] ç­æ¬¡ç®¡ç†ï¼ˆç™½ç­/å¤œç­ï¼‰
- [ ] è®¾å¤‡ç»´æŠ¤æ—¶é—´çª—å£
- [ ] æœ€å°æ‰¹é‡çº¦æŸ

### ä¸­æœŸ
- [ ] åŠ¨æ€åº“å­˜æ¶ˆè€—
- [ ] å¤šèµ„æºçº¦æŸï¼ˆäººå‘˜ã€å·¥è£…ï¼‰
- [ ] ç´§æ€¥è®¢å•æ’å•

### é•¿æœŸ
- [ ] Ganttå›¾å¯è§†åŒ–
- [ ] å®æ—¶è°ƒåº¦
- [ ] å¤šç›®æ ‡ä¼˜åŒ–

## ğŸ“š å‚è€ƒèµ„æ–™

- [OptaPlannerå®˜æ–¹æ–‡æ¡£](https://www.optaplanner.org/docs/optaplanner/latest/index.html)
- [ConstraintStreamsæŒ‡å—](https://www.optaplanner.org/docs/optaplanner/latest/constraint-streams/constraint-streams.html)
- [è¯¦ç»†è®¾è®¡æ–‡æ¡£](DESIGN.md)

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

---

**ä½œè€…**: CQH-2  
**æ—¥æœŸ**: 2026-01-07  
**ç‰ˆæœ¬**: 1.0.0
